# UI要件・仕様書

## プロジェクト概要

IME辞書管理ツールのUI動作仕様と要件を定義するドキュメント

---

## モーダル表示仕様

### 基本方針

- **モーダルは必要最小限の使用**
- **成功時は自動でデータ反映、モーダル非表示**
- **エラー時のみユーザー操作を求める**

### ゲーム追加・編集

```
✅ 正常時の流れ：
1. ユーザーがゲーム追加ボタンクリック
2. モーダル表示
3. ユーザーがゲーム名入力
4. 保存ボタンクリック
5. データベース保存成功
6. モーダル自動で閉じる
7. ゲーム選択リストに反映
8. 新しく作成したゲームを自動選択

❌ エラー時の流れ：
1-4. 同上
5. データベース保存失敗
6. エラーメッセージ表示（モーダル内）
7. ユーザーが修正するまでモーダル表示継続
```

### 単語追加

```
✅ 正常時の流れ：
1. ユーザーが単語追加ボタンクリック
2. 最下行に空行追加し、「reading」欄にフォーカス
3. ユーザーが単語情報入力
4. 保存ボタンクリックするかフォーカス外したタイミングでバリデーション実施
5. バリデーション問題ある場合、トーストUIで警告し、問題のある入力欄にフォーカス
6. データベース保存成功
7. モーダル自動で閉じる
8. 単語リストに反映
9. 登録した単語が末尾の場合、次の単語登録を開始（最下行のreading欄にフォーカス）

❌ エラー時の流れ：
1-4. 同上
5. バリデーションエラー/保存失敗
6. エラーメッセージ表示（モーダル内）
7. ユーザーが修正するまでモーダル表示継続
```

### 単語編集（更新）

✅ 正常時の流れ：
対象ワードを選択したら編集に移行。以後は登録時と同様

❌ エラー時の流れ：
追加時と同様

---

## 自動選択仕様

### ゲーム作成後

- **新しく作成したゲームを自動選択**
- ゲーム選択セレクトボックスの値を更新
- 単語管理エリアを該当ゲーム用に更新

### 単語作成後

- **作成した単語が一覧に表示される**

---

## エラーハンドリング仕様

### エラー表示方法

1. **モーダル内エラー**: フォーム入力エラー
2. **トースト通知**: 一時的な操作フィードバック
3. **インライン表示**: リアルタイムバリデーション

### エラー種別

```
■ バリデーションエラー
- 必須項目未入力
- 文字数制限超過
- 重複名前チェック

■ システムエラー
- データベース接続エラー
- ファイル読み書きエラー
- 権限エラー
```

---

## 成功時フィードバック仕様

### 基本方針

- 連続登録を想定し、正常動作時は通知を表示しないか、短時間のフィードバックに留める

### 実装方針

```javascript
// 正常ケース例
async function onGameSubmit(e) {
  try {
    const result = await saveGame();
    closeModal(); // 即座にモーダルを閉じる
    refreshGameList(); // データを反映
    selectGame(result.id); // 自動選択
    showSuccessToast("ゲームを追加しました"); // 簡潔な確認
  } catch (error) {
    showErrorInModal(error.message); // モーダル内にエラー表示
    // モーダルは開いたまま
  }
}
```

---

## テスト要件

### UI テストの期待動作

1. **正常系**: 成功通知が表示されること
2. **異常系**: モーダルが開いたままでエラー表示されること
3. **データ反映**: 作成したデータが即座に反映されること
4. **自動選択**: 新規作成項目が選択されること

### テスト実装指針

```javascript
// 正常系テスト例
test("ゲーム追加成功時", async () => {
  await openGameModal();
  await fillGameName("テストゲーム");
  await clickSave();

  // モーダルが閉じることを確認
  await expect(gameModal).not.toBeVisible();

  // 作成したゲームが選択されることを確認
  await expect(gameSelect).toHaveValue(newGameId);
});

// 異常系テスト例
test("ゲーム追加エラー時", async () => {
  await openGameModal();
  await fillGameName(""); // 空文字でエラー発生
  await clickSave();

  // モーダルが開いたままであることを確認
  await expect(gameModal).toBeVisible();

  // エラーメッセージが表示されることを確認
  await expect(errorMessage).toBeVisible();
});
```

---
