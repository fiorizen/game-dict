# UI要件・仕様書

## プロジェクト概要
IME辞書管理ツールのUI動作仕様と要件を定義するドキュメント

---

## モーダル表示仕様

### 基本方針
- **モーダルは必要最小限の使用**
- **成功時は自動でデータ反映、モーダル非表示**
- **エラー時のみユーザー操作を求める**

### ゲーム追加・編集
```
✅ 正常時の流れ：
1. ユーザーがゲーム追加ボタンクリック
2. モーダル表示
3. ユーザーがゲーム名入力
4. 保存ボタンクリック
5. データベース保存成功
6. モーダル自動で閉じる
7. ゲーム選択リストに反映
8. 新しく作成したゲームを自動選択

❌ エラー時の流れ：
1-4. 同上
5. データベース保存失敗
6. エラーメッセージ表示（モーダル内）
7. ユーザーが修正するまでモーダル表示継続
```

### 単語追加・編集
```
✅ 正常時の流れ：
1. ユーザーが単語追加ボタンクリック
2. モーダル表示
3. ユーザーが単語情報入力
4. 保存ボタンクリック
5. データベース保存成功
6. モーダル自動で閉じる
7. 単語リストに反映

❌ エラー時の流れ：
1-4. 同上
5. バリデーションエラー/保存失敗
6. エラーメッセージ表示（モーダル内）
7. ユーザーが修正するまでモーダル表示継続
```

---

## 自動選択仕様

### ゲーム作成後
- **新しく作成したゲームを自動選択**
- ゲーム選択セレクトボックスの値を更新
- 単語管理エリアを該当ゲーム用に更新

### 単語作成後
- **作成した単語が一覧に表示される**
- 検索・フィルター状態を維持

---

## エラーハンドリング仕様

### エラー表示方法
1. **モーダル内エラー**: フォーム入力エラー
2. **トースト通知**: 一時的な操作フィードバック
3. **インライン表示**: リアルタイムバリデーション

### エラー種別
```
■ バリデーションエラー
- 必須項目未入力
- 文字数制限超過
- 重複名前チェック

■ システムエラー
- データベース接続エラー
- ファイル読み書きエラー
- 権限エラー
```

---

## 成功時フィードバック仕様

### 基本方針
- **サイレント動作**: 正常動作時は邪魔にならない
- **即座の反映**: UI即座に更新
- **簡潔な確認**: 短時間のサクセス表示

### 実装方針
```javascript
// 正常ケース例
async function onGameSubmit(e) {
  try {
    const result = await saveGame();
    closeModal();           // 即座にモーダルを閉じる
    refreshGameList();      // データを反映
    selectGame(result.id);  // 自動選択
    showSuccessToast("ゲームを追加しました"); // 簡潔な確認
  } catch (error) {
    showErrorInModal(error.message); // モーダル内にエラー表示
    // モーダルは開いたまま
  }
}
```

---

## テスト要件

### UI テストの期待動作
1. **正常系**: モーダルが自動で閉じること
2. **異常系**: モーダルが開いたままでエラー表示されること
3. **データ反映**: 作成したデータが即座に反映されること
4. **自動選択**: 新規作成項目が選択されること

### テスト実装指針
```javascript
// 正常系テスト例
test('ゲーム追加成功時', async () => {
  await openGameModal();
  await fillGameName('テストゲーム');
  await clickSave();
  
  // モーダルが閉じることを確認
  await expect(gameModal).not.toBeVisible();
  
  // 作成したゲームが選択されることを確認
  await expect(gameSelect).toHaveValue(newGameId);
});

// 異常系テスト例  
test('ゲーム追加エラー時', async () => {
  await openGameModal();
  await fillGameName(''); // 空文字でエラー発生
  await clickSave();
  
  // モーダルが開いたままであることを確認
  await expect(gameModal).toBeVisible();
  
  // エラーメッセージが表示されることを確認
  await expect(errorMessage).toBeVisible();
});
```

---

## 改訂履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|-----------|----------|--------|
| 2025-06-21 | v1.0 | 初版作成 | Claude Code |

---

## 承認・レビュー

- [ ] 機能要件確認
- [ ] UI/UX検証  
- [ ] 技術仕様確認
- [ ] テスト要件確認